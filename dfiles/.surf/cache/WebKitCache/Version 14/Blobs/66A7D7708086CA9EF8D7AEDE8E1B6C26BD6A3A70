(window.webpackJsonp=window.webpackJsonp||[]).push([[173,301],{1344:function(e,t,n){var i,r=[].slice;void 0===(i=function(){var e,t,n,i,s,o,a;if(e=window._alConfig["segment/analytics"],null!=window.analytics)return{track:function(e,t,n,i){var r;return r=!0===(t=this.addPageviewArg(t)).send_to_intercom,n=this.addIntercomIntegrationFlag(n,r),delete t.send_to_intercom,window.analytics.track.apply(window.analytics,[e,t,n,i])},page:function(e,t,n,i,r){return null!=window._pageviewId&&(window._pageviewId=window._pageviewId.substring(0,32)+Math.random().toString(36).substring(0,16)+Math.random().toString(36).substring(0,16)),n=this.addPageviewArg(n),window.analytics.page.apply(window.analytics,[e,t,n,i,r])},addPageviewArg:function(e){return null==window._pageviewId?e:(e||(e={}),e.pageviewId=window._pageviewId,e)},addIntercomIntegrationFlag:function(t,n){return t||(t={}),t.integrations={Intercom:e.send_to_intercom&&n},t},showIntercomWidget:function(){return window.analytics.page({},{Intercom:{hideDefaultLauncher:!1}})}};for(t={},o=e.logging_enabled,n=function(e){return t[e]=function(){var e;if(e=1<=arguments.length?r.call(arguments,0):[],o)return"undefined"!=typeof console&&null!==console?console.log(e):void 0}},i=0,s=(a=["track","page"]).length;i<s;i++)n(a[i]);return t}.apply(t,[]))||(e.exports=i)},1358:function(e,t,n){var i,r,s=function(e,t){return function(){return e.apply(t,arguments)}};i=[n(2),n(59),n(25)],void 0===(r=function(e,t,n){var i;return i=function(){function t(t,n,i){var r;this.toggle=t,this.menu=null!=n?n:e(".menu",this.toggle),this.options=null!=i?i:{},this._position_inner_menu=s(this._position_inner_menu,this),this._position_menu=s(this._position_menu,this),this._respond_to_menu_clicked=s(this._respond_to_menu_clicked,this),this._respond_to_toggle_clicked=s(this._respond_to_toggle_clicked,this),this._hide_menu=s(this._hide_menu,this),r={left:!0,opened_class:"opened",top:!1,over:!1,offset_top:0},this.options=e.extend({},r,this.options)}return t.prototype.bind=function(){if(this.menu.length&&this.toggle.length)return this.toggle.on("click",this._respond_to_toggle_clicked),this.menu.on("click",this._respond_to_menu_clicked),this.options.top&&(e(this.menu).find(".dropdown-nub-wrapper").addClass("flipped"),e(this.menu).find(".dropdown-nub").addClass("flipped")),e(window).on("resize",this._position_menu),this._position_menu(),this},t.prototype.unbind=function(){return this.prevent_hide_once=!1,this.toggle.off("click",this._respond_to_toggle_clicked),this.menu.off("click",this._respond_to_menu_clicked),e(window).off("resize",this._position_menu),this._hide_menu(),this},t.hideAll=function(){return this.trigger("hide")},t.prototype._hide_menu=function(){return this.prevent_hide_once||(this.menu.hide(),this.toggle.removeClass(this.options.opened_class),e("body").off("click",this._hide_menu),t.off("hide",this._hide_menu)),this.prevent_hide_once=!1,!0},t.prototype._respond_to_toggle_clicked=function(){return this.toggle.hasClass(this.options.opened_class)||(t.hideAll(),this._position_menu(),this.menu.show(),this.options.inner_menu&&this._position_inner_menu(),this.toggle.addClass(this.options.opened_class),this.prevent_hide_once=!0,e("body").on("click",this._hide_menu),t.on("hide",this._hide_menu),t.trigger("show",this)),!0},t.prototype._respond_to_menu_clicked=function(e){return"A"===e.target.tagName||"A"===e.target.parentNode.tagName||"A"===e.target.parentNode.parentNode.tagName?this._hide_menu():this.prevent_hide_once=!0},t.prototype._position_menu=function(){var e,t,n,i,r;return t=this.toggle.position(),r=this.options.top?t.top-this.menu.outerHeight()+(this.options.over?this.toggle.outerHeight():0):t.top+this.options.offset_top+(this.options.over?0:this.toggle.outerHeight()),e=this.options.center?t.left-this.menu.outerWidth()/2+this.toggle.outerWidth()/2:this.options.left?t.left:t.left-this.menu.outerWidth()+this.toggle.outerWidth(),r+=null!=(n=this.options.adjust_top)?n:0,e+=null!=(i=this.options.adjust_left)?i:0,this.menu.css({position:"absolute",top:r,left:e})},t.prototype._position_inner_menu=function(){var t,n;if(e(".dropdown-inner-menu").css({"margin-left":0}),n=this.options.inner_menu.offset().left+this.menu.outerWidth(),(t=e(window).width()-n-10)<0)return e(".dropdown-inner-menu").css({"margin-left":t+"px"})},t}(),n.extend(i,t.Events)}.apply(t,i))||(e.exports=r)},1394:function(e,t,n){(function(i){var r,s;r=[n(25)],void 0===(s=function(e){var t,n;return{simple_format:n=function(e){return e=e.replace(/\r\n?/,"\n"),(e=i.trim(e)).length>0&&(e="<p>"+(e=(e=e.replace(/\n\n+/g,"</p><p>")).replace(/\n/g,"<br />"))+"</p>"),e},auto_link:t=function(t,n){var i,r,s,o;for(i in null==n&&(n={}),s=/(?:([\w+.:-]+:)(?:\/|\&#x2F\;)(?:\/|\&#x2F\;)|(www\.))([^\s<]+)/gi,r="",n)o=n[i],r+=" "+e.escape(i)+"='"+e.escape(o)+"'";return t.replace(s,function(e,t,n,i){var s,o;return i=i.replace(/&#x2F;/g,"/"),(o=/([^\w]*)$/.exec(i))[0],s=o[1],i=i.substring(0,i.length-s.length),"/",0===s.indexOf("/")&&(s=s.substring("/".length),i+="/"),s=s.replace(/\//g,"&#x2F;"),e=e.substring(0,e.length-s.length),"<a href='"+(t||"http:")+"//"+(n||"")+i+"'"+r+">"+e+"</a>"+s})},link_and_format:function(i){return t(n(e.escape(i)),{target:"_blank"})},truncate_on_word_boundary:function(e,t,n){var i;return null==t&&(t=30),null==n&&(n="..."),e.length>t?(i=t-n.length,(i=e.substr(0,i+1).lastIndexOf(" "))<0&&(i=0),e.substr(0,i)+"..."):e.toString()},number_to_human:function(e,t){var n,i,r,s;for(null==t&&(t={}),r=t.precision||0,i=(s=["K","M","B","T"]).length-1;i>=0;){if(e<=-(n=Math.pow(1e3,i+1))||e>=n)return+(e/n).toFixed(r)+s[i];i--}return e.toString()},number_with_delimiter:function(e,t){var n;return null==t&&(t={}),(n=e.toString().split("."))[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.join(".")},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},pluralize:function(e,t,n){return null==n&&(n=""),1===e?t:n||t+"s"}}}.apply(t,r))||(e.exports=s)}).call(this,n(2))},1439:function(e,t,n){var i,r;i=[n(2),n(25)],void 0===(r=function(e,t){return{render:function(e,n){var i;return i={interpolate:/\{\{(.+?)\}\}/g,evaluate:/\{\-(.+?)\-\}/g,escape:/\{\{\-(.+?)\-\}\}/g},t.template(e,n,i)}}}.apply(t,i))||(e.exports=r)},158:function(e,t,n){var i,r,s=function(e,t){return function(){return e.apply(t,arguments)}},o=function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},a={}.hasOwnProperty;i=[n(2),n(59),n(1439),n(25),n(1358),n(1344),n(1355),n(1361),n(60),n(153)],void 0===(r=function(e,t,n,i,r,a,c,u,l){var d;return d=i.extend({},t.Events),{show_edge:function(r,c){return new(function(t){function c(){return this._onClose=s(this._onClose,this),this._onRequestIntro=s(this._onRequestIntro,this),c.__super__.constructor.apply(this,arguments)}return o(c,t),c.prototype.tpl=r(".js-metadata-row-template").html(),c.prototype.events={"change .js-context-select":"_onContextSelect","change .js-relationship-select":"_onRelationshipSelect","click .js-add-metadatas":"_onAddMetadatas","click .js-remove-metadata":"_onRemoveMetadata","click .js-confirm-metadata":"_onConfirmMetadata","click .js-unconfirm-metadata":"_onRemoveMetadata","click .js-request-intro":"_onRequestIntro","click .js-close":"_onClose","click .js-undo":"_onUndo","click .js-disconnect":"_onDisconnect","click .js-cancel-metadata":"_onCancelMetadata","click .js-next":"_onClickNext"},c.prototype.initialize=function(){var e,t,n,i,r,s,o,c;for(this.source=this.$el.data("source"),this.neighbor_id=this.$el.data("neighborId"),this.neighbor_first_name=this.$el.data("neighborFirstName"),this.user_graph_request_id=this.$el.data("userGraphRequestId"),a.track("UserGraph.MetadataShow",{source:this.source,neighbor_id:this.neighbor_id}),this.$el.data("track_guesses")&&a.track("UserGraph.NumGuesses",{source:this.source,neighbor_id:this.neighbor_id,num_guesses:this.$el.data("metadata").length}),this.metadata={},e=0,n=(s=this.$el.data("metadata")).length;e<n;e++)r=s[e],this._addMetadataRow(r);for(this.context_map=this.$(".js-add-metadata-container").data("context_map"),this.$(".js-loading-container").hide(),this.$(".js-show-edge-container").show(),this.$(".js-disconnect").magnificPopup({type:"ajax"}),this.freeform_relationships=["co-worker","collaborator","classmate","mentor","mentee","advisor","advisee","manager","employee"],t=0,i=(o=this.freeform_relationships).length;t<i;t++)c=o[t],this.context_map[c]||(this.context_map[c]=[]);return this.context_free_relationships=["family","friend","acquaintance"],this.$(".tiptip, .js-pending-button").qtip()},c.prototype._addMetadataRow=function(e){return this.metadata[e.id]=e,this.$(".js-existing-metadata-container").append(n.render(this.tpl,e))},c.prototype._onAddMetadatas=function(){return this.$(".js-add-metadatas-button-container").hide(),this.$(".js-add-metadatas-container").show(),a.track("UserGraph.ShowAddMetadata",{source:this.source,neighbor_id:this.neighbor_id})},c.prototype._onRelationshipSelect=function(){var e;return e=this.$(".js-relationship-select").val(),this.context_free_relationships.indexOf(e)>-1?(this.$(".js-context-autocomplete-container").empty().hide(),this.$(".js-context-select-container").addClass("u-hidden"),this.$(".js-context-select-at").addClass("u-hidden"),void this._onAddMetadata()):(0===this.$(".js-context-select-container").length?this._showAutocompleteContext():(this._refreshContextSelect(e),this.$(".js-context-select-container").removeClass("u-hidden"),this.$(".js-context-select-at").removeClass("u-hidden")),a.track("UserGraph.SelectRelationship",{source:this.source,neighbor_id:this.neighbor_id,relationship:e}))},c.prototype._onContextSelect=function(){var e;return e=this.$(".js-context-select").val(),a.track("UserGraph.SelectContext",{source:this.source,neighbor_id:this.neighbor_id,context:e}),"other"===e?this._showAutocompleteContext():(this.$(".js-context-autocomplete-container").empty().hide(),this._onAddMetadata())},c.prototype._showAutocompleteContext=function(){var t,n,i,r;return this.$(".js-context-autocomplete-container").empty().removeClass("u-hidden"),i=e("<input>",{type:"text",class:"js-context-autocomplete context-autocomplete"}),this.$(".js-context-autocomplete-container").append(i),"classmate"!==(r=this.$(".js-relationship-select").val())?(n="Startup",i.attr("placeholder","Type company name"),t=new u.TypedAutocomplete({el:i,types:["Startup"]})):"classmate"===r&&(n="NewTag",i.attr("placeholder","Type college name"),t=new u.TagAutocomplete({el:i,tag_type:"CollegeTag"})),this.listenTo(t,"select",function(e){return function(t){var i;return i="NewTag"===n?t.tag.id:t.id,e._onAddMetadata(i,n)}}(this)),this.$(".js-context-autocomplete").focus()},c.prototype._refreshContextSelect=function(t){var n,i,r,s,o;if(this.$(".js-context-select").empty(),this.context_map[t].length>0){for(this.$(".js-context-select").append(e("<option>",{value:"",disabled:!0}).text("Choose One")),i=0,r=(o=this.context_map[t]).length;i<r;i++)s=(n=o[i]).name.length>25?n.name.slice(0,23)+"...":n.name,this.$(".js-context-select").append(e("<option>",{value:n.id,title:n.name}).text(s));this.$(".js-context-select").val("")}if(!(this.freeform_relationships.indexOf(t)>-1&&(this.$(".js-context-select").append(e("<option>",{value:"other"}).text("Other")),0===this.context_map[t].length)))return this.$(".js-context-autocomplete-container").empty().addClass("u-hidden");this._showAutocompleteContext()},c.prototype._refreshRelationshipSelect=function(){if(i.keys(this.context_map).length)return this.$(".js-relationship-select").val(i.keys(this.context_map)[0]),this._onRelationshipSelect()},c.prototype._onAddMetadata=function(t,n){var i,s,o;if(s=this.$(".js-relationship-select").val()){if(this.context_free_relationships.indexOf(s)>-1)t=null,n=null;else if(!n){if("other"===(i=this.$(".js-context-select").val()))return;if(!i)return;o=i.indexOf("_"),t=i.slice(0,o),n=i.slice(o+1)}if(t&&n||this.context_free_relationships.indexOf(s)>-1)return r(".js-errors-container").slideUp(),this.$(".js-add-metadata-container").hide(),this.$(".js-add-metadata-loading-container").show(),e.ajax({url:this.$(".js-add-metadata-container").data("add_url"),type:"POST",data:{"user_graph_edge_metadata[context_id]":t,"user_graph_edge_metadata[context_type]":n,"user_graph_edge_metadata[relationship]":s,"user_graph_edge_metadata[user_graph_edge_id]":this.$(".js-add-metadata-container").data("user_graph_edge_id")},success:function(e){return function(t){return e.metadata[t.id]||e._addMetadataRow(t),e.$(".js-existing-metadata-container").animate({scrollTop:e.$(".js-metadata-container").last().offset().top}),e.$(".js-add-metadata-loading-container").hide(),e.$(".js-add-metadata-container").show(),e.$(".js-context-autocomplete-container").empty().addClass("u-hidden"),e.$(".js-context-select-container").addClass("u-hidden"),e.$(".js-context-select-at").addClass("u-hidden"),e.$(".js-relationship-select").val(""),a.track("UserGraph.AddMetadata",{source:e.source,neighbor_id:e.neighbor_id,relationship:s,context_type:n})}}(this)})}},c.prototype._onRemoveMetadata=function(t){var n,i;return(i=e(t.target).parents(".js-metadata-container")).find(".js-metadata-content").empty().append(e(this.$(".js-loading-container")[0]).clone().show()),n=this.metadata[i.data("id")],r(".js-errors-container").slideUp(),e.ajax({url:i.data("remove_url"),type:"POST",success:function(e){return function(t){return i.slideUp(300,function(){return i.remove()}),delete e.metadata[n.id],a.track("UserGraph.RemoveMetadata",{source:e.source,neighbor_id:n.neighbor_id,relationship:n.relationship,context_type:n.context_type,guessed:n.guessed,is_inviter:n.is_inviter})}}(this)})},c.prototype._onConfirmMetadata=function(t,i){var r;return i||(i=e(t.target).parents(".js-metadata-container")),i.find(".js-metadata-content").empty().append(e(this.$(".js-loading-container")[0]).clone().show()),r=this.metadata[i.data("id")],e.ajax({url:i.data("confirm_url"),type:"POST",success:function(e){return function(t){return i.empty().append(n.render(e.tpl,t.metadata))}}(this)},a.track("UserGraph.ConfirmMetadata",{source:this.source,neighbor_id:r.neighbor_id,relationship:r.relationship,context_type:r.context_type,guessed:r.guessed,is_inviter:r.is_inviter}))},c.prototype._onCancelMetadata=function(){return this.$(".js-context-select-container").addClass("u-hidden"),this.$(".js-context-select-at").addClass("u-hidden"),this.$(".js-relationship-select").val("")},c.prototype._onRequestIntro=function(t){return this.$(".js-undo").length>0&&this.$(".js-undo").click(),e.magnificPopup.close()},c.prototype._onClose=function(t){var n;return this._onAddMetadata(),this.$(".js-close").data("modal")?(e.magnificPopup.close(),n=!0,d.trigger("close_graph_modal",{neighbor_id:this.neighbor_id,connected:n}),d.trigger("user_graph_update")):window.location=this.$(".js-close").data("url")},c.prototype._onUndo=function(t){return e.post(e(t.target).data("href")),a.track("UserGraph.ConnectUndo",{source:this.source,neighbor_id:this.neighbor_id}),d.trigger("user_graph_update"),!1,d.trigger("close_graph_modal",{neighbor_id:this.neighbor_id,connected:!1}),e.magnificPopup.close()},c.prototype._onClickNext=function(){var t;if(d.trigger("intro_clicked_next"),d.trigger("close_graph_modal",{neighbor_id:this.neighbor_id}),e.magnificPopup.close(),t=this.$(".js-metadata-container[data-show_confirm=false]").length>0,("message_button"===this.source||"people_message_button"===this.source)&&t)return e.facybox({ajax:r(".js-next").data("href")})},c}(t.View))({el:c})},disconnect_edge:function(n,i){return new(function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,t),i.prototype.events={"click .js-disconnect":"_onDisconnect","click .js-cancel":"_onCancel"},i.prototype.initialize=function(){return this.neighbor_id=this.$el.data("neighborId"),this.source=this.$el.data("source"),this.modal=this.$el.data("modal")},i.prototype._onCancel=function(t){return a.track("UserGraph.DisconnectCancel",{source:this.source,neighbor_id:this.neighbor_id}),e.magnificPopup.close()},i.prototype._onDisconnect=function(t){if(e.ajax({url:n(".js-disconnect").data("href"),method:"DELETE",success:function(e){return function(t){return a.track("UserGraph.Disconnect",{source:e.source,neighbor_id:e.neighbor_id}),d.trigger("user_graph_update")}}(this)}),e.magnificPopup.close(),c("You are now disconnected."),!this.modal)return window.location.href="/"},i}(t.View))({el:i})},connections_index:function(t,n){return t(".js-more-button").click(function(){return e(this).hide(),t(".js-card-row").show()})},events:function(){return d}}}.apply(t,i))||(e.exports=r)},1585:function(e,t,n){var i,r,s={}.hasOwnProperty;i=[n(151)],void 0===(r=function(e){return function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return function(e,t){for(var n in t)s.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(n,e("Slug")),n}()}.apply(t,i))||(e.exports=r)},1590:function(e,t,n){var i,r,s=function(e,t){return function(){return e.apply(t,arguments)}},o=function(e,t){for(var n in t)a.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},a={}.hasOwnProperty;i=[n(2),n(59),n(25),n(52),n(1394),n(1361),n(109),n(1585),n(1807),n(157),n(1808),n(1591)],void 0===(r=function(e,t,n,i,r,a,c,u){var l,d,h,p,_,f,g;return p=n.uniqueId("lib_mentions"),d=n.template("<span\nclass='"+i.classNames("coffeescripts/lib/mentions").join(" ")+" autocomplete_mention'>@<%- displayName || slug %></span>"),g=n.template('<a class="at_mention_link" data-type="<%- sluggable_type %>" data-id="<%- sluggable_id %>" href="<%- name %>">\n  <span class="at_mention_symbol">@</span><span class="at_mention_slug"><%- sluggable_to_s %></span>\n</a>'),l={},h=function(t){return l[t]||(l[t]=e.get("/mentions/search",{mention:t},null,"json"),n.delay(function(){return l[t]=null},6e4)),l[t]},f="\\s<>&\\(\\)\\?!,.:;'\"",_=function(e,t,i){var r;return r=new RegExp("(?=["+f+"\\"+t+"])","g"),n.map(e.split(r),function(e){return e[0]===t&&e.length>1?i(e.slice(1)):e}).join("")},{Autocomplete:function(t){function r(){return this._search=s(this._search,this),this._transformTokens=s(this._transformTokens,this),this.updateTarget=s(this.updateTarget,this),this.render=s(this.render,this),r.__super__.constructor.apply(this,arguments)}return o(r,t),r.prototype.results=function(t){return 0===t.length?[]:e.when(h(t))},r.prototype.renderMention=function(e){var t,n;if(n=e.get("name"),null==(t=e.get("sluggable_to_s")))throw new Error("No display name loaded for slug");return d({slug:n,displayName:t})},r.prototype.renderSelect=function(e){return a.render_item({image:e.pic,main_text:e.highlighed_name,detail_text:e.desc})},r.prototype.resultToSlug=function(e){return(this.collection.findWhere({name:e.slug})||new u).set({name:e.slug,sluggable_to_s:n.unescape(e.name),sluggable_id:e.id,sluggable_type:e.type})},r.prototype.initialize=function(t){if(this.collection||(this.collection=c.get(u)),this.$el.is(":input"))throw new Error("Must be applied to a container element, not to an input directly");if(this.$target=e(t.target),!this.$target.is(":input"))throw new Error("Must provide a target input (generally hidden) to contain the value to submit to the server");return this._initializeElement(),this.$editable=this._initializeEditable(),this.$highlighter=this._initializeHighlighter(),this._$intermediary=e('<input type="hidden" value=""/>'),this.render()},r.prototype.render=function(){if(!this._nestedRender)return this._nestedRender=!0,this._$intermediary.val(this.$target.val().replace(new RegExp("\\"+this._at+"(?=[^\\s])","g"),this._atReplacement)),this._renderEditable(),this._renderHighlighter(),this._nestedRender=!1},r.prototype.updateTarget=function(){if(!this._nestedUpdateTarget)return this._nestedUpdateTarget=!0,this._$intermediary.val(this.$editable.val().replace(new RegExp("\\"+this._marker+"[^\\"+this._marker+"]+(?=\\"+this._marker+"(["+f+"]|$))","g"),function(e){return function(t){var n,i;return n=t.slice(1),null!=(i=(e._slugNamesByRenderedText||{})[n])?""+e._atReplacement+i:t}}(this)).replace(new RegExp("\\"+this._marker,"g"),"")),this.$target.val(this._$intermediary.val().replace(new RegExp("\\"+this._atReplacement,"g"),this._at)).trigger("change"),this._renderEditable(),this._renderHighlighter(),this._nestedUpdateTarget=!1},r.prototype.events={change:"updateTarget",input:"updateTarget",keyup:"updateTarget"},r.prototype.delegateEvents=function(){var t,n;return r.__super__.delegateEvents.apply(this,arguments),this.$target.on("change",function(e){return function(){if(!e._nestedUpdateTarget)return e.render()}}(this)),this.$editable.atwho({at:this._at,alias:"mentions",displayTpl:function(t){return function(n){var i;return i=t.resultToSlug(n),e(t._renderMentionWithMetadata(i)).text(),e(t.renderSelect(n)).wrap("<li>").parent().attr("data-"+p+"_slug",JSON.stringify(i.toJSON())).wrap("<p>").parent().html()}}(this),insertTpl:function(t){return function(n){var i;return i=t.resultToSlug(n),e(t._renderMentionWithMetadata(i)).text()}}(this),callbacks:{highlighter:function(e,t){return e},remoteFilter:this._search,tplEval:function(e,t){return e(t)},sorter:function(e,t,n){return t},matcher:function(e,t,n){var i;return e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n&&(e="(?:^|\\s)"+e),(i=new RegExp(e+"([ A-Za-z0-9_+-]*)$|"+e+"([^\\x00-\\xff]*)$","gi").exec(t))?i[2]||i[1]:null}}}),t=this.$editable.data("atwho").controllers["@"],n=t.insert,t.insert=function(e){return function(i,r){var s;if(null==(s=r.data(p+"_slug")).name)throw new Error("Slug name expected in attributes");return e.collection.findWhere({name:s.name})||e.collection.add(s),n.call(t,""+e._marker+i+e._marker,r)}}(this)},r.prototype.undelegateEvents=function(){return r.__super__.undelegateEvents.apply(this,arguments),this.$target.off("change",this.render),this.$editable.atwho("destroy")},r.prototype._at="@",r.prototype._marker=String.fromCharCode(8203),r.prototype._atReplacement=String.fromCharCode(8205),r.prototype._initializeElement=function(){if(this.$el.css({position:"relative"}),"auto"===this.$el.css("z-index"))return this.$el.css("z-index",0)},r.prototype._initializeEditable=function(){var t;return(t=this.$("textarea")[0])||(t=e("<textarea />")).appendTo(this.$el),(t=e(t)).autosize(),t.css("background-color","transparent"),t},r.prototype._initializeHighlighter=function(){var t,n,r,s,o,a,c,u,l;for(n=e("<div class='"+i.classNames("coffeescripts/lib/mentions").join(" ")+" highlighter' />").insertBefore(this.$editable),l=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","lineHeight","minHeight","borderRadius"],r=0,o=(c=["Left","Right","Top","Bottom"]).length;r<o;r++)t=c[r],l.push("padding"+t),l.push("margin"+t),l.push("border"+t+"Width");for(s=0,a=l.length;s<a;s++)u=l[s],n.css(u,this.$editable.css(u));return n},r.prototype._renderEditable=function(){var t,n,i,r,s,o,a;if(a=this._transformTokens(!1,function(t){return function(n){var i;return i=t._renderMentionWithMetadata(n),t._marker+e(i).text()+t._marker}}(this)),(t=this.$editable.val())!==a){if(o=0,n=this.$editable.is(":focus"))for(o=0,i=r=0,s=this.$editable.caret("pos")-1;0<=s?r<=s:r>=s;i=0<=s?++r:--r)a[o]===t[i]&&o++;if(this.$editable.val(a),this.$editable.trigger("autosize.resize"),n)return this.$editable.caret("pos",o)}},r.prototype._renderHighlighter=function(){return this.$highlighter.html(this._transformTokens(!0,function(e){return function(t){return e._renderMentionWithMetadata(t)}}(this)))},r.prototype._transformTokens=function(e,t){var i;return i=this._$intermediary.val(),e&&(i=n.escape(i)),_(i,this._atReplacement,function(e){return function(n){var i;return null!=(i=e.collection.findWhere({name:n}))?t(i):(e._loadData(),""+e._at+n)}}(this))},r.prototype._renderMentionWithMetadata=function(t){var n,i;if(!t.has("name"))throw new Error("Slug name expected in model");if(this._renderedMentions||(this._renderedMentions={}),this._slugNamesByRenderedText||(this._slugNamesByRenderedText={}),!this._renderedMentions[t.get("name")]){for(i=e(this.renderMention(t)).attr("data-marker",this._marker),n=!0;null!=this._slugNamesByRenderedText[i.text()];)i.html(i.html()+(n?"&nbsp;":" ")),n=!n;this._renderedMentions[t.get("name")]=i.wrap("<p>").parent().html(),this._slugNamesByRenderedText[i.text()]=t.get("name")}return this._renderedMentions[t.get("name")]},r.prototype._search=function(t,n){var i;return this._searchId||(this._searchId=0),this._searchId++,i=this._searchId,e.when(this.results(t)).done(function(e){return function(t){if(e._searchId===i)return n(t)}}(this))},r.prototype._loadData=n.once(function(){return e.get("/mentions/init_mentions",{text:this.$target.val()},function(e){return function(t){var n,i,r,s,o;for(i in s=t.active_mentions||{})r=(n=s[i]).slug.replace(/^@/,""),(o=e.collection.findWhere({name:r})||new u).set({name:r,sluggable_to_s:i.replace(/^@/,""),sluggable_type:n.type,sluggable_id:n.id}),e.collection.add(o);return e.render()}}(this),"json")}),r}(t.View),UpdatingField:function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.initialize=function(e){if(this.collection||(this.collection=c.get(u)),this.field=e.field,null==this.field)throw new Error("Must provide a field to listen to");return this.listenTo(this.model,"change:"+this.field,this.render)},n.prototype.render=function(){var t,n,i;return n=this._preprocessText(),i=this,t=function(){var n;return e(this).contents().length>0?e(this).contents().each(t):(n=_(e(this).text(),"@",function(e){var t;return null!=(t=i.collection.findWhere({name:e}))?i.renderMention(t):"@"+e}),null!=e(this).html()?e(this).html(n):e(this).replaceWith(n))},this.$el.empty().append(e(n).each(t)),this},n.prototype.renderMention=function(e){return g(e.toJSON())},n.prototype._preprocessText=function(){return r.link_and_format(this.model.escape(this.field))},n}(t.View)}}.apply(t,i))||(e.exports=r)},1591:function(e,t,n){},327:function(e,t,n){var i,r,s=function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty,a=function(e,t){return function(){return e.apply(t,arguments)}},c=[].slice;i=[n(2),n(25),n(59),n(1358),n(108),n(1361),n(1533),n(1590),n(1344),n(158),n(159),n(153),n(60)],void 0===(r=function(e,t,i,r,o,u,l,d,h,p,_){return{new:function(t,n){return t(".js-show-attachment-field").click(function(){return e(this).remove(),t(".js-attachment-field").show()}),t(".js-message-attachment-input").change(function(){if(this.files[0].size>10485760)return e(this).replaceWith(e(this).clone(!0)),alert("Please select a file under 10MB")}),t(".cancel").on("click",function(){var t;return null!=(t=e.magnificPopup.instance)?t.close():void 0}),t(".js-submit").on("click",function(){t(".js-submit").val("Sending..."),h.track("Message.MessageSent",{source:n.data("source"),sender_id:n.data("senderId"),recipient_id:n.data("recipientId")}),n.data("source")})},form:function(t,n){return new d.Autocomplete({el:t(".body_container"),target:t(":input.body_hidden")}),t("textarea.body").focus(),t(".js-show-attachment-field").click(function(){return e(this).remove(),t(".js-attachment-field").show()}),t(".js-message-attachment-input").change(function(){if(this.files[0].size>10485760)return e(this).replaceWith(e(this).clone(!0)),alert("Please select a file under 10MB")})},compose:function(e,t){return e(".embedded_message textarea").focus()},embedded_composer:function(t,n){return new(function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,t),n.prototype.events=function(){return{"click .js-send-message":"onSendClicked","click .js-message-editor":"onEditorClicked"}},n.prototype.onEditorClicked=function(e){return e.preventDefault(),e.stopPropagation()},n.prototype.onSendClicked=function(e){return this._submitMessage(),e.preventDefault(),e.stopPropagation()},n.prototype._submitMessage=function(){var t;if(this.$(".send-success").hide(),this.$(".send-error").hide(),(t=this.$(".js-message-editor").val()).length)return this.$(".js-message-editor").val(""),e.ajax({url:this.$el.data("message-path")+".js",type:"POST",dataType:"json",data:{inbox:"talent",src:this.$el.data("src"),message:{recipient_type:"User",recipient_id:this.$el.data("recipient-id"),thread_id:this.$el.data("thread-id"),body:t}},success:function(e){return function(t){return t.success?e.$(".send-success").show():e.$(".send-error").show()}}(this),error:function(e){return function(t){return e.$(".send-error").show()}}(this)})},n}(i.View))({el:n})},inbox_compose:function(n,r){var o,d;return o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.request_options=function(e){return{url:"/autocomplete/connections",data:{query:e},dataType:"json",type:"get"}},n.prototype.process_response=function(e,i){var r,s,o;return o=t.uniq(e.results,!1,function(e){return e.id}),e.results=o,(r=n.__super__.process_response.call(this,e,i)).length>0?r:(s=t.template("<a href='/social'>\n  <div class=\"u-colorGray3 u-fontSize13 u-textAlignCenter u-block s-vgPadTop0_5 s-vgPadBottom0_5 s-vgPadLeft1 s-vgPadRight1\">\n    You can only message direct connections. Add connections &raquo;\n  </div>\n</a>"),r.push({label:s,value:{}}),r)},n}(u.TypedAutocomplete),d=function(n){function i(){return this._select=a(this._select,this),i.__super__.constructor.apply(this,arguments)}return s(i,n),i.prototype.initialize=function(e){var t;if(this.associationTemplate=e.associationTemplate,i.__super__.initialize.apply(this,arguments),this.$el.data("default_user"))return t=new _(this.$el.data("default_user")),this.addAssociation(t)},i.prototype.initializeAutocomplete=function(){return new o({el:this.input(),types:["User"]})},i.prototype.removeAssociation=function(t){return i.__super__.removeAssociation.apply(this,arguments),e(this.input()).val(""),this.trigger("disableMessageButton")},i.prototype._select=function(){var t,n;if(t=1<=arguments.length?c.call(arguments,0):[],(n=this.associationFromSelect.apply(this,t)).get("id"))return this.addAssociation(n),e(this.input()).val(""),!0},i.prototype.renderAssociation=function(e){var n,i;if(e.get("id"))return this.trigger("enableMessageButton"),this.trigger("hideMessageHint"),n={name:e.get("display_name"),url:e.get("slug_url"),photo:e.get("pic"),allowDelete:this.isEditable()},i={interpolate:/\{\{(.+?)\}\}/g,evaluate:/\{\-(.+?)\-\}/g,escape:/\{\{(.+?)\}\}/g},t.template(this.associationTemplate.trim(),n,i)},i}(l.UserField),new(function(t){function n(){return this._bindListeners=a(this._bindListeners,this),n.__super__.constructor.apply(this,arguments)}return s(n,t),n.prototype.initialize=function(){return this._initializeUserField(),h.track("Messages.ViewedComposeNew")},n.prototype._initializeUserField=function(){var e;if((e=this.$(".js-user-tagger")).length>0)return this.userField=new d({el:e,associationTemplate:this.$(".js-user-template").html()}),this._bindListeners(),this.userField.associations().length>0?this.userField.trigger("enableMessageButton"):void 0},n.prototype._bindListeners=function(){return this.listenTo(this.userField,"enableMessageButton",function(e){return function(){return e.$(".js-send-message").removeClass("c-button--disabled disabled"),e.$(".js-compose-input").focus()}}(this)),this.listenTo(this.userField,"disableMessageButton",function(e){return function(){return e.$(".js-send-message").addClass("c-button--disabled disabled"),e.$(".js-message-hint").show()}}(this)),this.listenTo(this.userField,"hideMessageHint",function(e){return function(){return e.$(".js-message-hint").hide()}}(this))},n.prototype.events=function(){return{"click .js-show-attachment-field":function(){return this.$(".js-show-attachment-field").remove(),this.$(".js-attachment-field").show()},"change .js-message-attachment-input":function(t){var n;if((n=t.currentTarget).files[0].size>10485760)return e(n).replaceWith(e(n).clone(!0)),alert("Please select a file under 10MB")}}},n}(i.View))({el:r})},show:function(e,t){return e(".tiptip").qtip({defaultPosition:"left"})},index:function(t,n){return new r(t(".js-dropdown-button"),t(".js-dropdown-menu"),{left:!0,offset_top:-7}).bind(),t(".thread").on("click",function(t){var n;if(!e(t.target).hasClass("unverified-thread"))return e(t.target).is("a, .photo, img")?void 0:(n=e(this).find(".preview > a").attr("href"),t.ctrlKey||t.metaKey?window.open(n,"_blank"):window.location=n)}),t(".js-edit-connection").click(function(t){return e.magnificPopup.open({closeOnBgClick:!1,showCloseBtn:!1,enableEscapeKey:!1,items:{src:e(t.currentTarget).data("url")},type:"ajax"})}),t(".js-add-connection").click(function(n){var i,r;return i=t(this).data("invited-id"),r=t(this).data("url"),e.ajax({url:r,type:"POST",data:{invited_id:i},success:function(t){return e.magnificPopup.open({closeOnBgClick:!1,showCloseBtn:!1,enableEscapeKey:!1,items:{src:"/user_graph_edges/"+t.edge_id+"?post_request=true&source=messages&request_id="+t.request_id},type:"ajax"})},error:function(e){return flash(e.responseJSON.error?e.responseJSON.error:"An error occurred, please try reloading the page.")}})}),t(".tip").qtip(),p.events().on("close_graph_modal",function(e){var n;if(e.connected)return(n=t(".unverified-container[data-neighbor_id="+e.neighbor_id+"]")).find(".verify-connection").hide(),n.find(".unverified-preview").show(),n.parents(".thread").removeClass("unverified-thread")})},profile_message:function(e,t){return n.e(31).then(function(){var t=[n(1641)];(function(){return e(".date").livestamp(e(".date").data("timestamp"))}).apply(null,t)}.bind(this)).catch(n.oe)},profile:function(t,n){return t("> .more_link").on("click",function(){return t(this).hide(),t("> .message.hidden").show()}),t(".body_mentions").each(function(){return new d.Autocomplete({el:this,target:t(".body_target")})}),t(".new_message").each(function(){return t("textarea",this).focus(function(e){return function(){return t(".submit",e).show()}}(this)),t(this).ajaxForm(o.loadingOptions(this,{dataType:"json",success:function(n){return e("<div/>").addClass("message").insertBefore(t(".new_message")).append(e(n.html)),t(".new_message textarea").val("")}}))}),t(".canned_link").click(function(){return t(this).addClass("loading"),e.get(t(this).attr("href"),{},function(e){return function(n){return t(e).removeClass("loading"),t(".new_message textarea").focus().val(n.msg_body).trigger("change").trigger("autosize.resize")}}(this)),!1})},send_feedback:function(t,n){return t("textarea").focus(),t("form").submit(function(){return t(".g-button").addClass("loading"),e(this).ajaxSubmit({success:function(e){return t(".close").click()}}),!1})},intro_request:function(t,n){return h.track("IntroRequest.ShowIntroRequestMessage",{source:"Messages"}),t(".js-refer").click(function(t){return h.track("IntroRequest.ShowReferralForm",{source:"Messages"}),e.magnificPopup.open({items:{src:e(t.currentTarget).data("url")},type:"ajax"})})},referral:function(e,t){return h.track("IntroRequest.ShowReferralMessage",{source:"Messages"}),e(".js-view-candidate").click(function(e){return h.track("IntroRequest.TargetViewedCandidate",{source:"Messages"})})},message_request_popover:function(t,n){return new(function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return s(i,t),i.prototype.events=function(){return{"click .js-send-message":"sendMessage","click .js-close":"closePopover"}},i.prototype.sendMessage=function(e){if(!this.$(".js-send-message").hasClass("c-button--loading"))return this.$(".js-send-message").addClass("c-button--loading"),this.$("form").ajaxSubmit({dataType:"json",beforeSend:function(e){return function(){return e.$(".js-error").hide()}}(this),success:function(e){return function(t){if(e.$(".js-container").hide(),e.$(".js-finish").show(),h.track("Message.MessageSent",{sender_id:e.$el.data("senderId"),recipient_id:e.$el.data("recipientId")}),"social_module"===n.data("source"))return window.location.href.indexOf("src=find_people")>0?h.track("Message.MessageSentAfterViewingPeopleTransactions"):window.location.href.indexOf("src=find_services")>0?h.track("Message.MessageSentAfterViewingServices"):void 0}}(this),error:function(e){return function(t){var n;return n=JSON.parse(t.responseText),e.$(".js-error").fadeIn().text(n.errors.join(", "))}}(this),complete:function(e){return function(){return e.$(".js-send-message").removeClass("c-button--loading")}}(this)})},i.prototype.closePopover=function(){return e.magnificPopup.close()},i}(i.View))({el:n})},inbox_header:function(e,t){return new(function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.events=function(){return{"click .js-messages-link":function(){return h.track("Talent.Messages.FromPlatformInbox")}}},t}(i.View))({el:t})}}}.apply(t,i))||(e.exports=r)}}]);